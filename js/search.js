let searchIndex=[],searchIndexLoaded=!1;async function loadSearchIndex(){if(!searchIndexLoaded)try{const e=await fetch("search-index.json");searchIndex=await e.json(),searchIndexLoaded=!0}catch(e){console.error("加载搜索索引失败:",e)}}function search(e){if(!e.trim())return[];const t=e.toLowerCase().trim().split(/\s+/);return searchIndex.filter(e=>{const n=`${e.title} ${e.description} ${e.excerpt}`.toLowerCase();return t.every(e=>n.includes(e))})}function displayResults(e){const t=document.getElementById("search-results");t&&(0!==e.length?t.innerHTML=e.map(e=>`\n    <article class="post-item">\n      <h2><a href="${e.url}">${e.title}</a></h2>\n      <div class="post-meta">\n        <time>${e.date}</time>\n        <span class="category-tag">${e.category}</span>\n      </div>\n      <p class="description">${e.description}</p>\n    </article>\n  `).join(""):t.innerHTML='<p class="search-hint">没有找到相关文章</p>')}function initSearch(){const e=document.getElementById("search-input");if(e){if(e.dataset.initialized)return;e.dataset.initialized="true",e.addEventListener("focus",loadSearchIndex,{once:!0}),e.addEventListener("input",async e=>{await loadSearchIndex();displayResults(search(e.target.value))})}}document.addEventListener("DOMContentLoaded",initSearch),window.addEventListener("spa:pageload",initSearch),window.initSearch=initSearch;