!function(){"use strict";const t={contentSelector:".main-wrapper",linkSelector:'a[href]:not([href^="http"]):not([href^="#"])',transitionDuration:200,enableTransition:!0,cachePages:!0,maxCacheSize:10},e=new Map;let n=null;async function o(t=[]){if(t.length>0)try{await Promise.all(t.map(t=>function(t){return new Promise((e,n)=>{if(document.querySelector(`script[src="${t}"]`))return void e();const o=document.createElement("script");o.src=t,o.defer=!0,o.onload=e,o.onerror=n,document.body.appendChild(o)})}(t)))}catch(t){}window.dispatchEvent(new CustomEvent("spa:pageload")),window.initEncryptedContent&&window.initEncryptedContent(),window.initSearch&&window.initSearch()}async function r(r,i=!0){document.body.classList.add("spa-loading");try{const a=await async function(o){if(t.cachePages&&e.has(o))return e.get(o);n&&n.abort(),n=new AbortController;try{const r=await fetch(o,{signal:n.signal,headers:{"X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error(`HTTP ${r.status}`);const i=await r.text(),a=(new DOMParser).parseFromString(i,"text/html"),c=a.querySelector(t.contentSelector),s=a.querySelector("title");if(!c)throw new Error("Content not found");const l=[];a.querySelectorAll("script[src]").forEach(t=>{const e=t.getAttribute("src");(e.includes("search.js")||e.includes("encrypt.js")||e.includes("aes-mini.js"))&&l.push(e)});const d={content:c.innerHTML,title:s?s.textContent:document.title,url:o,scripts:l};if(t.cachePages&&(e.set(o,d),e.size>t.maxCacheSize)){const t=e.keys().next().value;e.delete(t)}return d}catch(t){throw"AbortError"!==t.name&&console.error("Failed to fetch page:",t),t}}(r);!async function(e){const n=document.querySelector(t.contentSelector);n&&(t.enableTransition?(n.style.opacity="0",n.style.transition=`opacity ${t.transitionDuration}ms`,setTimeout(async()=>{n.innerHTML=e.content,document.title=e.title,window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{n.style.opacity="1"},10),await o(e.scripts||[])},t.transitionDuration)):(n.innerHTML=e.content,document.title=e.title,window.scrollTo({top:0,behavior:"smooth"}),await o(e.scripts||[])))}(a),i&&history.pushState({url:r},a.title,r)}catch(t){window.location.href=r}finally{document.body.classList.remove("spa-loading")}}function i(){history.replaceState({url:window.location.pathname},document.title,window.location.pathname),document.addEventListener("click",e=>{const n=e.target.closest(t.linkSelector);if(!n)return;if("_blank"===n.target||n.hasAttribute("download")||n.getAttribute("href").startsWith("#")||e.ctrlKey||e.metaKey||e.shiftKey)return;e.preventDefault();const o=n.getAttribute("href");o!==window.location.pathname&&r(o)}),window.addEventListener("popstate",t=>{t.state&&t.state.url?r(t.state.url,!1):window.location.reload()})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i(),window.SPARouter={navigateTo:r,clearCache:()=>e.clear(),config:t}}();